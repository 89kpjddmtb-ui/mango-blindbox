<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>èŠ’æœç²¾çµç›²ç›’ - AIä¸ºä½ æŒ‘é€‰æƒŠå–œç¤¼ç‰©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary: #FF6B35;
            --primary-light: #FFB347;
            --secondary: #4ECDC4;
            --bg-gradient: linear-gradient(180deg, #FFF9F0 0%, #FFE8D6 50%, #FFD4BA 100%);
            --shadow: 0 10px 40px rgba(255, 107, 53, 0.2);
            --shadow-hover: 0 15px 50px rgba(255, 107, 53, 0.3);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }
        
        /* èƒŒæ™¯è£…é¥° */
        .bg-decoration {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }
        
        .floating-mango {
            position: absolute;
            font-size: 30px;
            opacity: 0.15;
            animation: float-random 8s ease-in-out infinite;
        }
        
        @keyframes float-random {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            50% { transform: translateY(-10px) rotate(-5deg); }
            75% { transform: translateY(-30px) rotate(3deg); }
        }
        
        /* é¡µé¢åˆ‡æ¢ */
        .page {
            display: none;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            z-index: 1;
            animation: pageEnter 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .page.active { display: block; }
        
        @keyframes pageEnter {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        @keyframes pageExit {
            to { opacity: 0; transform: translateX(-30px); }
        }
        
        /* èŠ’æœç²¾çµ - å‡çº§ç‰ˆ */
        .mango-mascot {
            text-align: center;
            margin: 30px 0;
            position: relative;
        }
        
        .mango-body {
            width: 140px;
            height: 160px;
            background: linear-gradient(145deg, #FFB347 0%, #FF8C42 50%, #FF6B35 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            position: relative;
            margin: 0 auto;
            box-shadow: 
                0 15px 35px rgba(255, 107, 53, 0.4),
                inset 0 -10px 20px rgba(0,0,0,0.1);
            animation: mangoFloat 3s ease-in-out infinite;
        }
        
        @keyframes mangoFloat {
            0%, 100% { transform: translateY(0) rotate(-2deg) scale(1); }
            50% { transform: translateY(-15px) rotate(2deg) scale(1.02); }
        }
        
        .mango-body .leaf {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 50px;
            height: 40px;
            background: linear-gradient(135deg, #8BC34A 0%, #558B2F 100%);
            border-radius: 0 100% 0 100%;
            animation: leafSway 2s ease-in-out infinite;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        @keyframes leafSway {
            0%, 100% { transform: translateX(-50%) rotate(-15deg); }
            50% { transform: translateX(-50%) rotate(15deg); }
        }
        
        .mango-face {
            position: absolute;
            top: 55%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
        }
        
        .eyes {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 0 5px;
        }
        
        .eye {
            width: 18px;
            height: 24px;
            background: white;
            border-radius: 50%;
            position: relative;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
            animation: blink 4s infinite;
        }
        
        @keyframes blink {
            0%, 96%, 100% { transform: scaleY(1); }
            98% { transform: scaleY(0.1); }
        }
        
        .eye::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 14px;
            background: #3E2723;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .eye::before {
            content: '';
            position: absolute;
            width: 4px;
            height: 5px;
            background: white;
            border-radius: 50%;
            top: 4px;
            right: 3px;
            z-index: 1;
        }
        
        .cheeks {
            position: absolute;
            top: 35px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 0 8px;
        }
        
        .cheek {
            width: 18px;
            height: 12px;
            background: rgba(255, 138, 128, 0.5);
            border-radius: 50%;
            filter: blur(2px);
        }
        
        .mouth {
            width: 30px;
            height: 15px;
            border-bottom: 4px solid #3E2723;
            border-radius: 0 0 30px 30px;
            margin: 0 auto;
            animation: smile 2s ease-in-out infinite;
        }
        
        @keyframes smile {
            0%, 100% { transform: scaleX(1); }
            50% { transform: scaleX(1.1); }
        }
        
        /* æ ‡é¢˜ */
        .header-title {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .title {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #FF6B35 0%, #FFB347 50%, #FF8C42 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
            letter-spacing: -1px;
        }
        
        .subtitle {
            font-size: 16px;
            color: #8B7355;
            line-height: 1.6;
        }
        
        /* ç‰¹æ€§å¡ç‰‡ */
        .features {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }
        
        .feature-item {
            text-align: center;
            background: rgba(255,255,255,0.8);
            padding: 20px 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            animation: featurePulse 2s ease-in-out infinite;
        }
        
        @keyframes featurePulse {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .feature-icon {
            font-size: 36px;
            margin-bottom: 8px;
            display: block;
        }
        
        .feature-text {
            font-size: 13px;
            color: #666;
            font-weight: 500;
        }
        
        /* æŒ‰é’® */
        .btn {
            border: none;
            border-radius: 50px;
            padding: 18px 40px;
            font-size: 18px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #FFB347 0%, #FF6B35 100%);
            color: white;
            box-shadow: var(--shadow);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-hover);
        }
        
        .btn-primary:active {
            transform: translateY(-1px) scale(0.98);
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer-btn 2s infinite;
        }
        
        @keyframes shimmer-btn {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
            margin-top: 15px;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 107, 53, 0.05);
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }
        
        /* è¿›åº¦æ¡ */
        .progress-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .progress-step {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #F0F0F0;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 16px;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }
        
        .progress-step.active {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            color: white;
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
        }
        
        .progress-step.done {
            background: linear-gradient(135deg, #52C41A, #389E0D);
            color: white;
        }
        
        .progress-step.done::after {
            content: 'âœ“';
        }
        
        .progress-step.done span {
            display: none;
        }
        
        .progress-line {
            flex: 1;
            height: 4px;
            background: #F0F0F0;
            margin: 0 15px;
            border-radius: 2px;
            position: relative;
            overflow: hidden;
        }
        
        .progress-line.active::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, var(--primary-light), var(--primary));
            animation: lineGrow 0.5s ease forwards;
        }
        
        @keyframes lineGrow {
            from { width: 0; }
            to { width: 100%; }
        }
        
        /* è¾“å…¥æ¡† */
        .input-section {
            background: rgba(255,255,255,0.9);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
        }
        
        .message-input {
            width: 100%;
            height: 140px;
            background: #F8F8F8;
            border: 2px solid transparent;
            border-radius: 18px;
            padding: 20px;
            font-size: 16px;
            resize: none;
            outline: none;
            transition: all 0.3s;
            font-family: inherit;
            line-height: 1.6;
        }
        
        .message-input:focus {
            border-color: var(--primary-light);
            background: white;
            box-shadow: 0 0 0 4px rgba(255, 179, 71, 0.15);
        }
        
        .input-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 12px;
            font-size: 13px;
            color: #999;
        }
        
        .char-count {
            font-weight: 600;
            color: var(--primary);
        }
        
        /* ç¤ºä¾‹æ ‡ç­¾ */
        .examples {
            margin-bottom: 30px;
        }
        
        .examples-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
            display: block;
            font-weight: 500;
        }
        
        .example-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .example-tag {
            background: linear-gradient(135deg, rgba(255, 179, 71, 0.1), rgba(255, 107, 53, 0.1));
            color: var(--primary);
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(255, 107, 53, 0.2);
        }
        
        .example-tag:hover {
            background: linear-gradient(135deg, rgba(255, 179, 71, 0.2), rgba(255, 107, 53, 0.2));
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.15);
        }
        
        /* é¢„ç®—é€‰é¡¹ */
        .budget-section {
            margin-bottom: 30px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .budget-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .budget-card {
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 25px 15px;
            text-align: center;
            border: 3px solid transparent;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }
        
        .budget-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-light), var(--primary));
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        
        .budget-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .budget-card.active {
            border-color: var(--primary);
            background: linear-gradient(145deg, rgba(255, 179, 71, 0.08), rgba(255, 107, 53, 0.12));
            transform: scale(1.02);
        }
        
        .budget-card.active::before {
            transform: scaleX(1);
        }
        
        .budget-amount {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .budget-label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .budget-tag {
            display: inline-block;
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.15), rgba(78, 205, 196, 0.25));
            color: var(--secondary);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }
        
        /* åŠ è½½é¡µ */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 70vh;
            text-align: center;
        }
        
        .loading-mango {
            width: 120px;
            height: 140px;
            position: relative;
            margin-bottom: 40px;
        }
        
        .loading-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #FFB347, #FF6B35);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: loadingPulse 1.5s ease-in-out infinite;
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
        }
        
        @keyframes loadingPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        .loading-text {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
        }
        
        .loading-dots {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .dot {
            width: 12px;
            height: 12px;
            background: var(--primary);
            border-radius: 50%;
            animation: dotBounce 1.4s ease-in-out infinite;
        }
        
        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes dotBounce {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-15px); }
        }
        
        .loading-status {
            font-size: 14px;
            color: #999;
            height: 20px;
        }
        
        /* ç›²ç›’ */
        .blindbox-section {
            margin-bottom: 30px;
        }
        
        .blindbox-hint {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255,255,255,0.6);
            border-radius: 15px;
        }
        
        .blindbox-container {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 30px;
        }
        
        .blindbox-item {
            flex: 1;
            background: linear-gradient(145deg, #FFB347, #FF6B35);
            border-radius: 24px;
            padding: 30px 12px;
            text-align: center;
            cursor: pointer;
            border: 4px solid transparent;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(255, 107, 53, 0.25);
        }
        
        .blindbox-item::before {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 300%;
            height: 300%;
            background: linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.2) 50%, transparent 60%);
            animation: boxShimmer 2.5s infinite;
        }
        
        @keyframes boxShimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }
        
        .blindbox-item:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: 0 15px 35px rgba(255, 107, 53, 0.35);
        }
        
        .blindbox-item.selected {
            border-color: #FFE66D;
            box-shadow: 0 0 30px rgba(255, 230, 109, 0.6);
            animation: selectedPulse 0.6s ease;
        }
        
        @keyframes selectedPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1.05); }
        }
        
        .blindbox-content {
            position: relative;
            z-index: 1;
        }
        
        .question-mark {
            font-size: 48px;
            font-weight: 700;
            color: rgba(255,255,255,0.95);
            margin-bottom: 15px;
            animation: questionFloat 2s ease-in-out infinite;
        }
        
        @keyframes questionFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .blindbox-num {
            font-size: 14px;
            color: rgba(255,255,255,0.9);
            margin-bottom: 12px;
            font-weight: 600;
        }
        
        .keyword-tag {
            background: rgba(255,255,255,0.25);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            color: white;
            display: inline-block;
            font-weight: 500;
            backdrop-filter: blur(5px);
        }
        
        .price-hint {
            font-size: 11px;
            color: rgba(255,255,255,0.8);
            margin-top: 10px;
        }
        
        /* ç¤¼ç‰©æ­æ™“ */
        .reveal-container {
            animation: revealPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        @keyframes revealPop {
            0% { transform: scale(0.8) rotate(-5deg); opacity: 0; }
            50% { transform: scale(1.05) rotate(2deg); }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }
        
        .gift-reveal {
            background: white;
            border-radius: 30px;
            padding: 35px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(255, 107, 53, 0.2);
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .gift-reveal::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #FFB347, #FF6B35, #FFB347);
        }
        
        .gift-image {
            width: 180px;
            height: 180px;
            margin: 0 auto 25px;
            background: linear-gradient(145deg, #FFF5F0, #FFE8E0);
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
            animation: giftFloat 3s ease-in-out infinite;
        }
        
        @keyframes giftFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-8px); }
        }
        
        .gift-name {
            font-size: 22px;
            font-weight: 700;
            color: #2C3E50;
            margin-bottom: 12px;
            line-height: 1.4;
        }
        
        .gift-desc {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .gift-price-section {
            background: linear-gradient(145deg, #FFF5F0, #FFEEE5);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
        }
        
        .price-label {
            font-size: 13px;
            color: #999;
            margin-bottom: 5px;
        }
        
        .gift-price {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #FF6B35, #FFB347);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .price-notice {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }
        
        .platform-badge {
            background: linear-gradient(135deg, rgba(78, 205, 196, 0.15), rgba(78, 205, 196, 0.25));
            color: var(--secondary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            display: inline-block;
            font-weight: 600;
        }
        
        .recommend-reason {
            background: rgba(255, 179, 71, 0.1);
            border-left: 4px solid var(--primary);
            padding: 15px 20px;
            border-radius: 0 15px 15px 0;
            margin-top: 20px;
            text-align: left;
        }
        
        .recommend-label {
            font-size: 12px;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .recommend-text {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }
        
        /* äº¬ä¸œè·³è½¬æŒ‰é’® */
        .jd-btn {
            background: linear-gradient(135deg, #E4393C, #C81623);
            color: white;
            padding: 20px 40px;
            font-size: 18px;
            font-weight: 700;
            border-radius: 50px;
            border: none;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 8px 25px rgba(228, 57, 60, 0.3);
            margin-bottom: 15px;
        }
        
        .jd-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(228, 57, 60, 0.4);
        }
        
        .jd-btn::before {
            content: 'ğŸ•';
            font-size: 24px;
        }
        
        .change-btn {
            background: white;
            color: #666;
            border: 2px solid #DDD;
            padding: 15px 30px;
            font-size: 15px;
            border-radius: 50px;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .change-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        /* è·³è½¬æç¤ºé¡µ */
        .redirect-container {
            text-align: center;
            padding: 40px 20px;
        }
        
        .redirect-icon {
            font-size: 80px;
            margin-bottom: 30px;
            animation: redirectBounce 1s ease infinite;
        }
        
        @keyframes redirectBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .redirect-title {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }
        
        .redirect-text {
            font-size: 15px;
            color: #666;
            line-height: 1.8;
            margin-bottom: 40px;
        }
        
        .redirect-hint {
            background: rgba(255, 179, 71, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .redirect-hint-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .redirect-hint-list {
            font-size: 13px;
            color: #666;
            text-align: left;
            line-height: 2;
        }
        
        /* åº•éƒ¨å®‰å…¨æç¤º */
        .security-notice {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.95);
            padding: 12px 20px;
            font-size: 12px;
            color: #999;
            text-align: center;
            border-top: 1px solid rgba(0,0,0,0.05);
            backdrop-filter: blur(10px);
        }
        
        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-height: 700px) {
            .mango-mascot { margin: 15px 0; }
            .mango-body { width: 120px; height: 140px; }
            .title { font-size: 28px; }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯è£…é¥° -->
    <div class="bg-decoration" id="bg-decoration"></div>
    
    <div class="container">
        <!-- é¡µé¢1: é¦–é¡µ -->
        <div class="page active" id="page-index">
            <div class="mango-mascot">
                <div class="mango-body">
                    <div class="leaf"></div>
                    <div class="mango-face">
                        <div class="eyes">
                            <div class="eye"></div>
                            <div class="eye"></div>
                        </div>
                        <div class="cheeks">
                            <div class="cheek"></div>
                            <div class="cheek"></div>
                        </div>
                        <div class="mouth"></div>
                    </div>
                </div>
            </div>
            
            <div class="header-title">
                <div class="title">èŠ’æœç²¾çµç›²ç›’</div>
                <div class="subtitle">å†™ä¸‹ä½ çš„å¿ƒæ„å¯„è¯­<br>AIä¸ºä½ æŒ‘é€‰ç¥ç§˜ç¤¼ç‰©</div>
            </div>
            
            <div class="features">
                <div class="feature-item">
                    <span class="feature-icon">ğŸ¤–</span>
                    <span class="feature-text">AIæ™ºèƒ½æ¨è</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">ğŸ</span>
                    <span class="feature-text">ç¥ç§˜ç›²ç›’</span>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">âœ¨</span>
                    <span class="feature-text">æƒŠå–œæ­æ™“</span>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="goToPage('page-message')">
                ğŸŠ å¼€å¯ç›²ç›’ä¹‹æ—…
            </button>
            
            <p style="text-align: center; font-size: 13px; color: #999; margin-top: 25px;">
                ğŸ’¡ å…è´¹æ¨è Â· æ»¡æ„å†ä¹° Â· äº¬ä¸œæ­£å“ä¿éšœ
            </p>
        </div>
        
        <!-- é¡µé¢2: è¾“å…¥å¯„è¯­ -->
        <div class="page" id="page-message">
            <div class="progress-bar">
                <div class="progress-step done"><span>1</span></div>
                <div class="progress-line active"></div>
                <div class="progress-step active"><span>2</span></div>
                <div class="progress-line"></div>
                <div class="progress-step"><span>3</span></div>
            </div>
            
            <div class="header-title">
                <div class="title" style="font-size: 26px;">å†™ä¸‹ä½ çš„å¿ƒæ„</div>
                <div class="subtitle">AIå°†æ ¹æ®ä½ çš„å¯„è¯­ï¼Œä¸ºä½ æŒ‘é€‰æœ€è´´å¿ƒçš„ç¤¼ç‰©</div>
            </div>
            
            <div class="input-section">
                <textarea 
                    class="message-input" 
                    id="message-input"
                    placeholder="ä¾‹å¦‚ï¼šé€ç»™æˆ‘æœ€å¥½çš„æœ‹å‹ï¼Œå¥¹æœ€è¿‘å·¥ä½œå¾ˆè¾›è‹¦ï¼Œæƒ³è®©å¥¹å¼€å¿ƒä¸€ä¸‹..."
                    maxlength="100"
                ></textarea>
                <div class="input-footer">
                    <span>ğŸ’¡ å¯ä»¥æè¿°æ”¶ç¤¼äººæ€§æ ¼ã€ä½ ä»¬çš„æ•…äº‹æˆ–ä½ æƒ³è¡¨è¾¾çš„æƒ…æ„Ÿ</span>
                    <span class="char-count"><span id="char-count">0</span>/100</span>
                </div>
            </div>
            
            <div class="examples">
                <span class="examples-title">ğŸ’­ å‚è€ƒç¤ºä¾‹ï¼ˆç‚¹å‡»å¿«é€Ÿå¡«å……ï¼‰ï¼š</span>
                <div class="example-tags">
                    <span class="example-tag" onclick="setMessage('æˆ‘å°±æ˜¯è¶…äººï¼Œä¸ºè‡ªå·±åŠ æ²¹æ‰“æ°”ï¼')">æˆ‘å°±æ˜¯è¶…äºº</span>
                    <span class="example-tag" onclick="setMessage('é€ç»™æœ€æ¸©æš–çš„TAï¼Œæ„Ÿè°¢ä¸€è·¯é™ªä¼´')">é€ç»™æœ€æ¸©æš–çš„ä½ </span>
                    <span class="example-tag" onclick="setMessage('å®‰æ…°æœ€è¿‘å¤±æ‹çš„é—ºèœœï¼Œæƒ³è®©å¥¹æŒ¯ä½œèµ·æ¥')">å®‰æ…°å¤±æ‹é—ºèœœ</span>
                    <span class="example-tag" onclick="setMessage('æ„¿ä½ æ¯å¤©éƒ½è¢«å¯çˆ±åŒ…å›´ï¼Œåšä¸ªå¿«ä¹çš„å°ä»™å¥³')">å¯çˆ±å°ä»™å¥³</span>
                    <span class="example-tag" onclick="setMessage('ç¨‹åºå‘˜ç”·å‹ç”Ÿæ—¥ï¼Œé€ä»–å®ç”¨çš„æ•°ç å¥½ç‰©')">ç¨‹åºå‘˜ç”·å‹</span>
                </div>
            </div>
            
            <button class="btn btn-primary" id="btn-next" onclick="goToBudget()" disabled>
                ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©é¢„ç®— ğŸ’°
            </button>
            
            <button class="btn btn-secondary" onclick="goToPage('page-index')">
                â† è¿”å›é¦–é¡µ
            </button>
        </div>
        
        <!-- é¡µé¢3: é€‰æ‹©é¢„ç®— -->
        <div class="page" id="page-budget">
            <div class="progress-bar">
                <div class="progress-step done"><span>1</span></div>
                <div class="progress-line active"></div>
                <div class="progress-step done"><span>2</span></div>
                <div class="progress-line active"></div>
                <div class="progress-step active"><span>3</span></div>
            </div>
            
            <div class="header-title">
                <div class="title" style="font-size: 26px;">é€‰æ‹©é¢„ç®—èŒƒå›´</div>
                <div class="subtitle">AIå°†ä¸ºä½ æ¨èä¸è¶…è¿‡è¯¥ä»·æ ¼çš„ç²¾é€‰ç¤¼ç‰©</div>
            </div>
            
            <div class="budget-section">
                <div class="budget-grid">
                    <div class="budget-card" onclick="selectBudget(10, this)">
                        <div class="budget-amount">10</div>
                        <div class="budget-label">è½»é‡çº§å¿ƒæ„</div>
                        <span class="budget-tag">å°æƒŠå–œ</span>
                    </div>
                    <div class="budget-card" onclick="selectBudget(30, this)">
                        <div class="budget-amount">30</div>
                        <div class="budget-label">æ—¥å¸¸å¥½ç¤¼</div>
                        <span class="budget-tag">éšæ‰‹é€</span>
                    </div>
                    <div class="budget-card" onclick="selectBudget(50, this)">
                        <div class="budget-amount">50</div>
                        <div class="budget-label">èµ°å¿ƒä¹‹é€‰</div>
                        <span class="budget-tag">æœ€å—æ¬¢è¿</span>
                    </div>
                    <div class="budget-card" onclick="selectBudget(150, this)">
                        <div class="budget-amount">150</div>
                        <div class="budget-label">å“è´¨ç¤¼ç‰©</div>
                        <span class="budget-tag">æœ‰æ¡£æ¬¡</span>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <div class="budget-card" onclick="showCustomBudget()" id="custom-budget-card">
                        <div class="budget-amount" style="font-size: 28px;">ğŸ’°</div>
                        <div class="budget-label">è‡ªå®šä¹‰é‡‘é¢</div>
                        <span class="budget-tag">éšå¿ƒé€‰</span>
                    </div>
                </div>
                
                <!-- è‡ªå®šä¹‰é‡‘é¢è¾“å…¥ -->
                <div id="custom-budget-input" style="display: none; margin-top: 15px; background: rgba(255,255,255,0.9); border-radius: 20px; padding: 20px;">
                    <div style="font-size: 14px; color: #666; margin-bottom: 10px;">è¾“å…¥ä½ çš„é¢„ç®—é‡‘é¢ï¼ˆå…ƒï¼‰</div>
                    <div style="display: flex; gap: 10px;">
                        <input type="number" id="custom-amount" placeholder="ä¾‹å¦‚ï¼š88" style="flex: 1; padding: 15px; border: 2px solid #eee; border-radius: 15px; font-size: 16px; outline: none;" oninput="validateCustomBudget(this.value)">
                        <button onclick="confirmCustomBudget()" id="btn-confirm-custom" style="padding: 15px 25px; background: linear-gradient(135deg, #FFB347, #FF6B35); color: white; border: none; border-radius: 15px; font-size: 16px; font-weight: 600; cursor: pointer;" disabled>ç¡®å®š</button>
                    </div>
                    <div style="font-size: 12px; color: #999; margin-top: 8px;">å»ºè®®èŒƒå›´ï¼š5-500å…ƒ</div>
                </div>
            </div>
            
            <button class="btn btn-primary" id="btn-recommend" onclick="startRecommend()" disabled>
                âœ¨ AIå¼€å§‹æ¨è
            </button>
            
            <button class="btn btn-secondary" onclick="goToPage('page-message')">
                â† è¿”å›ä¿®æ”¹å¯„è¯­
            </button>
        </div>
        
        <!-- é¡µé¢4: AIæ¨èåŠ è½½ -->
        <div class="page" id="page-loading">
            <div class="loading-container">
                <div class="loading-mango">
                    <div class="loading-body"></div>
                </div>
                <div class="loading-text">èŠ’æœç²¾çµæ­£åœ¨æ€è€ƒ...</div>
                <div class="loading-dots">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
                <div class="loading-status" id="loading-status">æ­£åœ¨åˆ†æä½ çš„å¿ƒæ„</div>
            </div>
        </div>
        
        <!-- é¡µé¢5: ç›²ç›’ä¸‰é€‰ä¸€ -->
        <div class="page" id="page-blindbox">
            <div class="blindbox-section">
                <div class="header-title">
                    <div class="title" style="font-size: 24px;">é€‰ä¸€ä¸ªç¥ç§˜ç›²ç›’</div>
                    <div class="subtitle">å‡­ç›´è§‰é€‰ä¸€ä¸ªï¼Œæ­æ™“ä½ çš„ä¸“å±ç¤¼ç‰©</div>
                </div>
                
                <div class="blindbox-hint">
                    ğŸ æ¯ä¸ªç›²ç›’éƒ½åŒ…å«ä¸€ä¸ªAIç²¾é€‰ç¤¼ç‰©<br>
                    é€‰ä¸­åæ­æ™“å…·ä½“å†…å®¹
                </div>
                
                <div class="blindbox-container" id="blindbox-container">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <button class="btn btn-secondary" onclick="goToPage('page-budget')">
                â† é‡æ–°é€‰æ‹©é¢„ç®—
            </button>
        </div>
        
        <!-- é¡µé¢6: æ­æ™“ç¤¼ç‰© -->
        <div class="page" id="page-reveal">
            <div class="reveal-container">
                <div class="gift-reveal">
                    <div class="gift-image" id="gift-image">ğŸ</div>
                    <div class="gift-name" id="gift-name">ç¤¼ç‰©åç§°</div>
                    <div class="gift-desc" id="gift-desc">ç¤¼ç‰©æè¿°</div>
                    
                    <div class="gift-price-section">
                        <div class="price-label">å‚è€ƒä»·æ ¼</div>
                        <div class="gift-price" id="gift-price">Â¥0</div>
                        <div class="price-notice">âš ï¸ å®é™…ä»·æ ¼ä»¥äº¬ä¸œé¡µé¢ä¸ºå‡†ï¼Œå¯èƒ½å­˜åœ¨æµ®åŠ¨</div>
                    </div>
                    
                    <span class="platform-badge">ğŸ›’ äº¬ä¸œç²¾é€‰</span>
                    
                    <div class="recommend-reason">
                        <div class="recommend-label">ğŸ¯ ä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªï¼Ÿ</div>
                        <div class="recommend-text" id="recommend-text">æ¨èç†ç”±</div>
                    </div>
                </div>
                
                <button class="jd-btn" onclick="goToJD()">
                    å»äº¬ä¸œè´­ä¹°
                </button>
                
                <button class="change-btn" onclick="goToPage('page-blindbox')">
                    ğŸ¤” ä¸æ»¡æ„ï¼Ÿæ¢ä¸€ä¸ªç›²ç›’
                </button>
            </div>
        </div>
        
        <!-- é¡µé¢7: è·³è½¬æç¤º -->
        <div class="page" id="page-redirect">
            <div class="redirect-container">
                <div class="redirect-icon">ğŸ•</div>
                <div class="redirect-title">æ­£åœ¨è·³è½¬è‡³äº¬ä¸œ...</div>
                <div class="redirect-text">
                    ä½ å°†è¢«å¼•å¯¼è‡³äº¬ä¸œå®Œæˆè´­ä¹°<br>
                    è¯·åœ¨äº¬ä¸œAPPæˆ–ç½‘é¡µä¸­å®Œæˆä¸‹å•
                </div>
                
                <div class="redirect-hint">
                    <div class="redirect-hint-title">ğŸ’¡ è´­ç‰©å°è´´å£«ï¼š</div>
                    <div class="redirect-hint-list">
                        â€¢ äº¬ä¸œæä¾›æ­£å“ä¿éšœå’Œå”®åæœåŠ¡<br>
                        â€¢ å¯äº«å—äº¬ä¸œç‰©æµå¿«é€Ÿé…é€<br>
                        â€¢ æ”¯æŒ7å¤©æ— ç†ç”±é€€æ¢è´§
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="goToPage('page-index')">
                    ğŸ å†ç©ä¸€æ¬¡
                </button>
            </div>
        </div>
    </div>
    
    <div class="security-notice">
        ğŸ”’ è´­ç‰©å®‰å…¨æç¤ºï¼šç‚¹å‡»è´­ä¹°åå°†è·³è½¬è‡³äº¬ä¸œå®˜æ–¹ç½‘ç«™ï¼Œè¯·åœ¨äº¬ä¸œå®Œæˆæ”¯ä»˜
    </div>

    <script>
        // ==================== åç«¯ API é…ç½® ====================
        const API_BASE = 'https://mango-blindbox-backend-production.up.railway.app';
        
        // ==================== æ•°æ®å­˜å‚¨ ====================
        let currentMessage = '';
        let selectedBudget = null;
        let recommendedGifts = [];
        let selectedGift = null;
        
        // ==================== æ•°æ®ä¸ŠæŠ¥ ====================
        async function logVisit(page) {
            try {
                await fetch(`${API_BASE}/api/analytics/visit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ page })
                });
            } catch (e) { console.log('è®°å½•è®¿é—®å¤±è´¥'); }
        }
        
        async function logMessage(message, budget) {
            try {
                await fetch(`${API_BASE}/api/analytics/message`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, budget })
                });
            } catch (e) { console.log('è®°å½•å¯„è¯­å¤±è´¥'); }
        }
        
        async function logSelection(message, budget, selectedBox, giftName, giftPrice) {
            try {
                await fetch(`${API_BASE}/api/analytics/selection`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message, budget, selectedBox, giftName, giftPrice })
                });
            } catch (e) { console.log('è®°å½•é€‰æ‹©å¤±è´¥'); }
        }
        
        async function logClick(giftName, giftPrice, keyword) {
            try {
                await fetch(`${API_BASE}/api/analytics/click`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ giftName, giftPrice, keyword })
                });
            } catch (e) { console.log('è®°å½•ç‚¹å‡»å¤±è´¥'); }
        }
        
        // ç¤¼ç‰©æ•°æ®åº“ï¼ˆé¢„å®šä¹‰ï¼Œå®é™…åº”ä»åç«¯è·å–ï¼‰
        const giftDatabase = {
            hero: [
                { name: 'æ¼«å¨è‹±é›„æ‰‹åŠå¥—è£…', desc: 'ç»å…¸è‹±é›„è§’è‰²ï¼Œç²¾è‡´æ”¶è—çº§æ‰‹åŠ', emoji: 'ğŸ¦¸', price: 45, keyword: 'è‹±é›„å®ˆæŠ¤', reason: 'ä½ æåˆ°äº†"è¶…äºº"ï¼Œè¿™æ˜¯è‹±é›„ä¸»é¢˜çš„ç»å…¸é€‰æ‹©ï¼Œä»£è¡¨åŠ›é‡å’Œå®ˆæŠ¤' },
                { name: 'è¶…äººæŠ«é£æ¯›æ¯¯', desc: 'æŸ”è½¯èˆ’é€‚ï¼Œç›–ä¸Šå˜èº«è¶…çº§è‹±é›„', emoji: 'ğŸ¦¸â€â™‚ï¸', price: 38, keyword: 'è¶…äººåŠ›é‡', reason: 'æ¸©æš–åˆå……æ»¡åŠ›é‡æ„Ÿçš„ç¤¼ç‰©ï¼Œæ¯å¤©ç›–ç€å®ƒéƒ½èƒ½æ„Ÿå—åˆ°è‡ªå·±çš„è¶…èƒ½åŠ›' },
                { name: 'è‹±é›„ä¸»é¢˜é©¬å…‹æ¯', desc: 'æ¯å¤©ä¸€æ¯ï¼Œå……æ»¡åŠ›é‡', emoji: 'â˜•', price: 28, keyword: 'è‹±é›„æ—¥å¸¸', reason: 'å®ç”¨åˆèµ°å¿ƒï¼Œæ¯æ¬¡å–æ°´éƒ½èƒ½æƒ³èµ·ä½ å¯¹è‡ªå·±çš„æœŸè®¸' }
            ],
            warm: [
                { name: 'æ˜Ÿç©ºæŠ•å½±ç¯', desc: 'æµªæ¼«æ˜Ÿç©ºï¼Œæ¸©é¦¨æ°›å›´', emoji: 'âœ¨', price: 35, keyword: 'æ˜Ÿå…‰å®ˆæŠ¤', reason: 'æ¸©æš–æ²»æ„ˆç³»çš„ç¤¼ç‰©ï¼Œé€‚åˆè¥é€ èˆ’é€‚æ”¾æ¾çš„æ°›å›´' },
                { name: 'é¦™è–°èœ¡çƒ›å¥—è£…', desc: 'èˆ’ç¼“èº«å¿ƒï¼Œæµªæ¼«æ°”æ¯', emoji: 'ğŸ•¯ï¸', price: 32, keyword: 'é¦™æ°›æµªæ¼«', reason: 'å¸¦æ¥æ¸©æš–å’Œå®é™ï¼Œæ˜¯ä¸€ä»½èµ°å¿ƒçš„æ²»æ„ˆä¹‹é€‰' },
                { name: 'æš–æ‰‹å®', desc: 'å†¬æ—¥æ¸©æš–ï¼Œæ¡åœ¨æ‰‹å¿ƒ', emoji: 'ğŸ”¥', price: 33, keyword: 'æ¸©æš–å®ˆæŠ¤', reason: 'å®å®åœ¨åœ¨çš„æ¸©æš–ï¼Œå°±åƒä½ å¯¹TAçš„å…³å¿ƒä¸€æ ·è´´å¿ƒ' }
            ],
            cute: [
                { name: 'èŠ’æœç²¾çµç©å¶', desc: 'è¶…èŒèŠ’æœé€ å‹ï¼Œæ²»æ„ˆç³»ä¼™ä¼´', emoji: 'ğŸ¥­', price: 36, keyword: 'èŒåŠ›å…¨å¼€', reason: 'å¯çˆ±æ²»æ„ˆï¼Œè®©TAæ¯å¤©éƒ½èƒ½è¢«èŒåŠ›åŒ…å›´' },
                { name: 'æ¯›ç»’é’¥åŒ™æ‰£', desc: 'è½¯èŒæŒ‚ä»¶ï¼Œéšèº«æºå¸¦', emoji: 'ğŸ§¸', price: 16, keyword: 'èŒè¶£éšè¡Œ', reason: 'å°å·§å¯çˆ±çš„é™ªä¼´ï¼Œéšæ—¶éšåœ°éƒ½èƒ½æƒ³èµ·ä½ çš„å¿ƒæ„' },
                { name: 'å¡é€šå‘å¤¹å¥—è£…', desc: 'å¯çˆ±é€ å‹ï¼Œå°‘å¥³å¿ƒçˆ†æ£š', emoji: 'ğŸ€', price: 15, keyword: 'ç”œç¾å¯çˆ±', reason: 'å°‘å¥³å¿ƒæ»¡æ»¡çš„å°ç‰©ï¼Œé€‚åˆå–œæ¬¢å¯çˆ±çš„TA' }
            ],
            tech: [
                { name: 'è¿·ä½ è“ç‰™éŸ³ç®±', desc: 'å°å·§ä¾¿æºï¼ŒéŸ³è´¨å‡ºè‰²', emoji: 'ğŸ”Š', price: 49, keyword: 'å£°åŠ¨äººå¿ƒ', reason: 'ç§‘æŠ€æ„Ÿåè¶³çš„å®ç”¨å¥½ç‰©ï¼Œé€‚åˆå–œæ¬¢æ•°ç äº§å“çš„TA' },
                { name: 'åˆ›æ„æ‰‹æœºæ”¯æ¶', desc: 'æ‡’äººç¥å™¨ï¼Œè¿½å‰§å¿…å¤‡', emoji: 'ğŸ“±', price: 18, keyword: 'è§£æ”¾åŒæ‰‹', reason: 'å®ç”¨åˆè´´å¿ƒçš„å°ç‰©ï¼Œè®©TAçš„ç”Ÿæ´»æ›´æ–¹ä¾¿' },
                { name: 'LEDå°å¤œç¯', desc: 'æ™ºèƒ½æ„Ÿåº”ï¼Œæ¸©é¦¨å®ˆæŠ¤', emoji: 'ğŸ’¡', price: 28, keyword: 'æ¸©æš–å¾®å…‰', reason: 'ç§‘æŠ€æ„Ÿä¸æ¸©æš–å¹¶å­˜ï¼Œå¤œé—´çš„å¥½ä¼´ä¾£' }
            ]
        };
        
        // ==================== é¡µé¢åˆ‡æ¢ ====================
        function goToPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
            
            // è®°å½•é¡µé¢è®¿é—®
            logVisit(pageId);
        }
        
        // ==================== é¦–é¡µè£…é¥° ====================
        function initBgDecoration() {
            const container = document.getElementById('bg-decoration');
            const emojis = ['ğŸ¥­', 'âœ¨', 'ğŸ', 'ğŸ’', 'ğŸŒŸ'];
            for (let i = 0; i < 8; i++) {
                const el = document.createElement('div');
                el.className = 'floating-mango';
                el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                el.style.left = Math.random() * 100 + '%';
                el.style.top = Math.random() * 100 + '%';
                el.style.animationDelay = Math.random() * 5 + 's';
                el.style.animationDuration = (6 + Math.random() * 4) + 's';
                container.appendChild(el);
            }
        }
        
        // ==================== å¯„è¯­é¡µé¢ ====================
        const messageInput = document.getElementById('message-input');
        const charCount = document.getElementById('char-count');
        const btnNext = document.getElementById('btn-next');
        
        messageInput.addEventListener('input', function() {
            currentMessage = this.value;
            charCount.textContent = currentMessage.length;
            btnNext.disabled = currentMessage.length === 0;
        });
        
        function setMessage(text) {
            messageInput.value = text;
            currentMessage = text;
            charCount.textContent = text.length;
            btnNext.disabled = false;
            // æ·»åŠ è½»å¾®åŠ¨ç”»åé¦ˆ
            messageInput.style.transform = 'scale(1.02)';
            setTimeout(() => messageInput.style.transform = 'scale(1)', 200);
        }
        
        function goToBudget() {
            if (!currentMessage.trim()) return;
            goToPage('page-budget');
        }
        
        // ==================== é¢„ç®—é¡µé¢ ====================
        function selectBudget(amount, element) {
            selectedBudget = amount;
            document.querySelectorAll('.budget-card').forEach(c => c.classList.remove('active'));
            element.classList.add('active');
            document.getElementById('btn-recommend').disabled = false;
            
            // éšè—è‡ªå®šä¹‰è¾“å…¥æ¡†
            document.getElementById('custom-budget-input').style.display = 'none';
        }
        
        function showCustomBudget() {
            // å–æ¶ˆå…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.budget-card').forEach(c => c.classList.remove('active'));
            document.getElementById('custom-budget-card').classList.add('active');
            
            // æ˜¾ç¤ºè‡ªå®šä¹‰è¾“å…¥æ¡†
            document.getElementById('custom-budget-input').style.display = 'block';
            document.getElementById('btn-recommend').disabled = true;
            
            // èšç„¦è¾“å…¥æ¡†
            setTimeout(() => document.getElementById('custom-amount').focus(), 100);
        }
        
        function validateCustomBudget(value) {
            const amount = parseInt(value);
            const btn = document.getElementById('btn-confirm-custom');
            
            if (amount && amount >= 5 && amount <= 500) {
                btn.disabled = false;
            } else {
                btn.disabled = true;
            }
        }
        
        function confirmCustomBudget() {
            const amount = parseInt(document.getElementById('custom-amount').value);
            if (amount && amount >= 5 && amount <= 500) {
                selectedBudget = amount;
                document.getElementById('btn-recommend').disabled = false;
                document.getElementById('custom-budget-input').style.display = 'none';
                
                // æ›´æ–°è‡ªå®šä¹‰å¡ç‰‡æ˜¾ç¤º
                document.querySelector('#custom-budget-card .budget-amount').textContent = `Â¥${amount}`;
                document.querySelector('#custom-budget-card .budget-amount').style.fontSize = '32px';
            }
        }
        
        // ==================== AIæ¨è ====================
        async function startRecommend() {
            if (!selectedBudget) return;
            
            // è®°å½•ç”¨æˆ·å¯„è¯­å’Œé¢„ç®—
            await logMessage(currentMessage, selectedBudget);
            
            goToPage('page-loading');
            
            // æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹
            const statuses = [
                'æ­£åœ¨åˆ†æä½ çš„å¿ƒæ„...',
                'æ­£åœ¨åŒ¹é…ç¤¼ç‰©åº“...',
                'æ­£åœ¨ç­›é€‰ç²¾é€‰å¥½ç‰©...',
                'æ­£åœ¨ç”Ÿæˆç›²ç›’...'
            ];
            
            let statusIndex = 0;
            const statusEl = document.getElementById('loading-status');
            
            const statusInterval = setInterval(() => {
                statusIndex++;
                if (statusIndex < statuses.length) {
                    statusEl.textContent = statuses[statusIndex];
                }
            }, 600);
            
            // åˆ†æå¯„è¯­å¹¶é€‰æ‹©åˆ†ç±»
            setTimeout(async () => {
                clearInterval(statusInterval);
                const category = analyzeMessage(currentMessage);
                
                // ä»åç«¯APIè·å–ç¤¼ç‰©åˆ—è¡¨
                try {
                    const response = await fetch(`${API_BASE}/api/gifts?category=${category}&budget=${selectedBudget}`);
                    const data = await response.json();
                    if (data.success) {
                        recommendedGifts = data.data;
                    } else {
                        // APIå¤±è´¥ä½¿ç”¨é»˜è®¤æ•°æ®
                        recommendedGifts = getDefaultGifts(category, selectedBudget);
                    }
                } catch (e) {
                    // å‡ºé”™ä½¿ç”¨é»˜è®¤æ•°æ®
                    recommendedGifts = getDefaultGifts(category, selectedBudget);
                }
                
                renderBlindbox();
                goToPage('page-blindbox');
            }, 2500);
        }
        
        function analyzeMessage(message) {
            const keywords = {
                hero: ['è¶…äºº', 'è‹±é›„', 'å¼ºå¤§', 'åŠ›é‡', 'å‹‡æ•¢', 'ä¿æŠ¤', 'å®ˆæŠ¤', 'åšå¼º', 'æ¼«å¨', 'åŠ æ²¹', 'æ‰“æ°”'],
                warm: ['æ¸©æš–', 'é™ªä¼´', 'æ„Ÿè°¢', 'å®‰æ…°', 'æ²»æ„ˆ', 'è¾›è‹¦', 'å…³å¿ƒ', 'è´´å¿ƒ'],
                cute: ['å¯çˆ±', 'èŒ', 'å°‘å¥³', 'ä»™å¥³', 'ç”œ', 'å¡å“‡ä¼Š', 'æ²»æ„ˆ'],
                tech: ['æ•°ç ', 'ç§‘æŠ€', 'ç¨‹åºå‘˜', 'å®ç”¨', 'ç”µå­', 'æ™ºèƒ½', 'ç”·å‹', 'è€å…¬']
            };
            
            const scores = { hero: 0, warm: 0, cute: 0, tech: 0 };
            const msg = message.toLowerCase();
            
            for (const [category, words] of Object.entries(keywords)) {
                for (const word of words) {
                    if (msg.includes(word)) scores[category]++;
                }
            }
            
            let bestCategory = 'cute';
            let maxScore = 0;
            for (const [cat, score] of Object.entries(scores)) {
                if (score > maxScore) {
                    maxScore = score;
                    bestCategory = cat;
                }
            }
            return bestCategory;
        }
        
        // é»˜è®¤ç¤¼ç‰©æ•°æ®ï¼ˆAPIå¤±è´¥æ—¶ä½¿ç”¨ï¼‰
        function getDefaultGifts(category, budget) {
            const defaults = {
                hero: [
                    { name: 'æ¼«å¨é’¢é“ä¾ æ‰‹åŠ', desc: 'æ­£ç‰ˆæˆæƒæ¼«å¨æ‰‹åŠï¼Œç²¾è‡´ç»†èŠ‚ï¼Œé«˜åº¦è¿˜åŸç”µå½±é€ å‹', price: 45, keyword: 'è‹±é›„å®ˆæŠ¤', sku: '100012043978', image: 'https://img14.360buyimg.com/n0/jfs/t1/123456/1/1234/123456.jpg', emoji: 'ğŸ¦¸', boxNum: 'A' },
                    { name: 'è¶…äººæŠ«é£æ¯›æ¯¯', desc: 'è¶…äººæ ‡å¿—æŠ«é£è®¾è®¡ï¼Œæ³•å…°ç»’æè´¨è¶…æŸ”è½¯', price: 38, keyword: 'è¶…äººåŠ›é‡', sku: '100008348542', image: 'https://img14.360buyimg.com/n0/jfs/t1/123457/1/1235/123457.jpg', emoji: 'ğŸ¦¸â€â™‚ï¸', boxNum: 'B' },
                    { name: 'è‹±é›„ä¸»é¢˜é©¬å…‹æ¯', desc: 'æ¼«å¨è‹±é›„ç³»åˆ—é™¶ç“·æ¯ï¼Œ400mlå¤§å®¹é‡', price: 28, keyword: 'è‹±é›„æ—¥å¸¸', sku: '100023456789', image: 'https://img14.360buyimg.com/n0/jfs/t1/123458/1/1236/123458.jpg', emoji: 'â˜•', boxNum: 'C' }
                ],
                warm: [
                    { name: 'æ˜Ÿç©ºæŠ•å½±ç¯', desc: 'æ¢¦å¹»æ˜Ÿç©ºæŠ•å½±ï¼Œ6ç§ç¯å…‰æ¨¡å¼ï¼ŒUSBä¾›ç”µ', price: 35, keyword: 'æ˜Ÿå…‰å®ˆæŠ¤', sku: '100014785236', image: 'https://img14.360buyimg.com/n0/jfs/t1/123460/1/1238/123460.jpg', emoji: 'âœ¨', boxNum: 'A' },
                    { name: 'é¦™è–°èœ¡çƒ›å¥—è£…', desc: 'å¤©ç„¶å¤§è±†èœ¡ï¼Œ6ç§é¦™å‹ç»„åˆï¼Œç‡ƒçƒ§40å°æ—¶', price: 32, keyword: 'é¦™æ°›æµªæ¼«', sku: '100018965472', image: 'https://img14.360buyimg.com/n0/jfs/t1/123461/1/1239/123461.jpg', emoji: 'ğŸ•¯ï¸', boxNum: 'B' },
                    { name: 'æš–æ‰‹å®å……ç”µå®äºŒåˆä¸€', desc: '5200mAhå¤§å®¹é‡ï¼Œ3ç§’é€Ÿçƒ­ï¼Œå¯ä¸Šé£æœº', price: 33, keyword: 'æ¸©æš–å®ˆæŠ¤', sku: '100021547896', image: 'https://img14.360buyimg.com/n0/jfs/t1/123462/1/1240/123462.jpg', emoji: 'ğŸ”¥', boxNum: 'C' }
                ],
                cute: [
                    { name: 'èŠ’æœç²¾çµç©å¶', desc: '30cmè¶…èŒèŠ’æœé€ å‹ï¼Œæ°´æ™¶è¶…æŸ”é¢æ–™', price: 36, keyword: 'èŒåŠ›å…¨å¼€', sku: '100025896347', image: 'https://img14.360buyimg.com/n0/jfs/t1/123465/1/1243/123465.jpg', emoji: 'ğŸ¥­', boxNum: 'A' },
                    { name: 'æ¯›ç»’é’¥åŒ™æ‰£', desc: 'è¶…è½¯å…”æ¯›æè´¨ï¼Œ12cmæŒ‚é¥°ï¼Œå¤šç§åŠ¨ç‰©é€ å‹', price: 16, keyword: 'èŒè¶£éšè¡Œ', sku: '100028741596', image: 'https://img14.360buyimg.com/n0/jfs/t1/123466/1/1244/123466.jpg', emoji: 'ğŸ§¸', boxNum: 'B' },
                    { name: 'å¡é€šå‘å¤¹å¥—è£…', desc: '12ä»¶å¥—è£…ï¼Œå¤šç§å¯çˆ±é€ å‹ï¼Œä¸ä¼¤å‘è®¾è®¡', price: 15, keyword: 'ç”œç¾å¯çˆ±', sku: '100031254789', image: 'https://img14.360buyimg.com/n0/jfs/t1/123467/1/1245/123467.jpg', emoji: 'ğŸ€', boxNum: 'C' }
                ],
                tech: [
                    { name: 'è¿·ä½ è“ç‰™éŸ³ç®±', desc: '360åº¦ç¯ç»•ç«‹ä½“å£°ï¼Œè“ç‰™5.0è¿æ¥ï¼Œ8å°æ—¶ç»­èˆª', price: 49, keyword: 'å£°åŠ¨äººå¿ƒ', sku: '100034567891', image: 'https://img14.360buyimg.com/n0/jfs/t1/123470/1/1248/123470.jpg', emoji: 'ğŸ”Š', boxNum: 'A' },
                    { name: 'åˆ›æ„æ‰‹æœºæ”¯æ¶', desc: '360åº¦æ—‹è½¬ï¼Œå¤šæ¡£ä½è°ƒèŠ‚ï¼ŒæŠ˜å ä¾¿æº', price: 18, keyword: 'è§£æ”¾åŒæ‰‹', sku: '100037894561', image: 'https://img14.360buyimg.com/n0/jfs/t1/123471/1/1249/123471.jpg', emoji: 'ğŸ“±', boxNum: 'B' },
                    { name: 'LEDå°å¤œç¯', desc: 'æ™ºèƒ½å…‰æ„Ÿæ„Ÿåº”ï¼ŒæŸ”å’Œæš–å…‰ä¸åˆºçœ¼ï¼ŒUSBä¾›ç”µ', price: 28, keyword: 'æ¸©æš–å¾®å…‰', sku: '100041237856', image: 'https://img14.360buyimg.com/n0/jfs/t1/123472/1/1250/123472.jpg', emoji: 'ğŸ’¡', boxNum: 'C' }
                ]
            };
            
            let gifts = defaults[category] || defaults.cute;
            gifts = gifts.filter(g => g.price <= budget);
            return gifts.length >= 3 ? gifts : [...gifts, ...defaults.cute].slice(0, 3);
        }

        // ==================== ç›²ç›’é¡µé¢ ====================
        function renderBlindbox() {
            const container = document.getElementById('blindbox-container');
            container.innerHTML = recommendedGifts.map((gift, index) => `
                <div class="blindbox-item" onclick="selectBlindbox(${index}, this)">
                    <div class="blindbox-content">
                        <div class="question-mark">?</div>
                        <div class="blindbox-num">ç›²ç›’ ${gift.boxNum}</div>
                        <span class="keyword-tag">${gift.keyword}</span>
                        <div class="price-hint">Â¥${Math.max(0, gift.price - 10).toFixed(2)} - Â¥${(gift.price + 10).toFixed(2)}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function selectBlindbox(index, element) {
            // æ·»åŠ é€‰ä¸­åŠ¨ç”»
            document.querySelectorAll('.blindbox-item').forEach(el => {
                el.classList.remove('selected');
                el.style.opacity = '0.5';
            });
            element.classList.add('selected');
            element.style.opacity = '1';
            
            selectedGift = recommendedGifts[index];
            
            // è®°å½•ç”¨æˆ·é€‰æ‹©
            logSelection(
                currentMessage, 
                selectedBudget, 
                selectedGift.boxNum,
                selectedGift.name,
                selectedGift.price
            );
            
            // å»¶è¿Ÿåæ­æ™“
            setTimeout(() => {
                revealGift();
            }, 800);
        }
        
        // ==================== æ­æ™“é¡µé¢ ====================
        function revealGift() {
            const imageEl = document.getElementById('gift-image');
            
            // æ–¹æ¡ˆBï¼šç›´æ¥æ˜¾ç¤ºemojiï¼Œä¸åŠ è½½å›¾ç‰‡
            imageEl.textContent = selectedGift.emoji || 'ğŸ';
            imageEl.style.fontSize = '80px';
            imageEl.style.display = 'flex';
            imageEl.style.alignItems = 'center';
            imageEl.style.justifyContent = 'center';
            
            document.getElementById('gift-name').textContent = selectedGift.name;
            document.getElementById('gift-desc').textContent = selectedGift.desc;
            document.getElementById('gift-price').textContent = `Â¥${parseFloat(selectedGift.price).toFixed(2)}`;
            
            // ç”Ÿæˆæ¨èç†ç”±
            const reason = selectedGift.desc || `AIæ ¹æ®ä½ çš„å¯„è¯­"${currentMessage}"ï¼Œä¸ºä½ ç²¾é€‰äº†è¿™ä¸ª${selectedGift.keyword}ä¸»é¢˜çš„ç¤¼ç‰©`;
            document.getElementById('recommend-text').textContent = reason;
            
            goToPage('page-reveal');
        }
        
        // ==================== äº¬ä¸œè·³è½¬ ====================
        async function goToJD() {
            // è®°å½•è´­ä¹°ç‚¹å‡»
            await logClick(selectedGift.name, selectedGift.price, selectedGift.keyword);
            
            // æ˜¾ç¤ºè·³è½¬æç¤ºé¡µ
            goToPage('page-redirect');
            
            // è°ƒç”¨åç«¯ç”Ÿæˆäº¬ä¸œé“¾æ¥ï¼ˆé€šè¿‡SKUï¼‰
            try {
                const response = await fetch(`${API_BASE}/api/jd-link`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        sku: selectedGift.sku,
                        name: selectedGift.name,
                        price: selectedGift.price
                    })
                });
                const data = await response.json();
                
                if (data.success && data.data.url) {
                    setTimeout(() => {
                        window.open(data.data.url, '_blank');
                    }, 2000);
                } else {
                    // å¤‡ç”¨ï¼šç›´æ¥æœç´¢
                    const searchUrl = `https://search.jd.com/Search?keyword=${encodeURIComponent(selectedGift.name)}&enc=utf-8`;
                    setTimeout(() => {
                        window.open(searchUrl, '_blank');
                    }, 2000);
                }
            } catch (e) {
                // å‡ºé”™æ—¶ç”¨å¤‡ç”¨é“¾æ¥
                const searchUrl = `https://search.jd.com/Search?keyword=${encodeURIComponent(selectedGift.name)}&enc=utf-8`;
                setTimeout(() => {
                    window.open(searchUrl, '_blank');
                }, 2000);
            }
        }
        
        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', function() {
            initBgDecoration();
        });
    </script>
</body>
</html>